<div class="top-bar" *ngIf="isTeacher()">
  <button mat-raised-button color="primary" (click)="toggleAddCourseForm()">
    {{ showAddCourseForm ? 'בטל הוספה' : 'הוסף קורס חדש' }}
  </button>
  <mat-card *ngIf="showAddCourseForm" class="add-course-card">
    <mat-card-title style="text-align: right;">הוסף קורס חדש</mat-card-title>
    <mat-card-content>
      <form [formGroup]="addCourseForm" (ngSubmit)="addCourse()" class="add-course-form">
        <mat-form-field appearance="outline">
          <mat-label>כותרת</mat-label>
          <input matInput formControlName="title" required />
          <mat-error *ngIf="addCourseForm.controls['title'].hasError('required')">שדה זה חובה</mat-error>
        </mat-form-field>
        <mat-form-field appearance="outline">
          <mat-label>תיאור</mat-label>
          <textarea matInput formControlName="description" required></textarea>
          <mat-error *ngIf="addCourseForm.controls['description'].hasError('required')">שדה זה חובה</mat-error>
        </mat-form-field>
        <button mat-raised-button color="primary" type="submit" [disabled]="addCourseForm.invalid">הוסף קורס</button>
      </form>
    </mat-card-content>
  </mat-card>
</div>

<!-- רשימת קורסים -->
<mat-card class="courses-list">
  <mat-card-title style="text-align: right;">רשימת קורסים</mat-card-title>
  <mat-card-content>
    <mat-accordion>
      <mat-expansion-panel *ngFor="let course of courses" [expanded]="selectedCourse?.id === course.id" (opened)="openCourse(course)">
        <mat-expansion-panel-header>
          <mat-panel-title>
            {{ course.title }}
          </mat-panel-title>
          <mat-panel-description>
            {{ course.description }}
          </mat-panel-description>
        </mat-expansion-panel-header>

        <!-- כפתורי עריכה/מחיקה של הקורס -->
        <div class="actions" style="margin-bottom: 10px;">
          <button mat-icon-button color="accent" (click)="startEditCourse(course)" *ngIf="canEditOrDelete(course)">
            <mat-icon>edit</mat-icon>
          </button>
          <button mat-icon-button color="warn" *ngIf="canEditOrDelete(course)" (click)="deleteCourse(course.id)">
            <mat-icon>delete</mat-icon>
          </button>
        </div>

        <!-- טופס הוספת שיעור -->
        <mat-card class="add-lesson-card" style="margin: 16px 0;" *ngIf="isTeacher()">
          <button mat-raised-button color="primary" (click)="toggleAddLessonForm()">
            {{ showAddLessonForm ? 'בטל הוספת שיעור' : 'הוסף שיעור חדש' }}
          </button>
          <form *ngIf="showAddLessonForm" [formGroup]="addLessonForm" (ngSubmit)="addLesson()" class="add-lesson-form" style="margin-top: 12px;">
            <mat-form-field appearance="outline">
              <mat-label>שם שיעור</mat-label>
              <input matInput formControlName="title" required />
              <mat-error *ngIf="addLessonForm.controls['title'].hasError('required')">שדה זה חובה</mat-error>
            </mat-form-field>
            <mat-form-field appearance="outline">
              <mat-label>תוכן השיעור</mat-label>
              <textarea matInput formControlName="content" required></textarea>
              <mat-error *ngIf="addLessonForm.controls['content'].hasError('required')">שדה זה חובה</mat-error>
            </mat-form-field>
            <button mat-raised-button color="primary" type="submit" [disabled]="addLessonForm.invalid">הוסף שיעור</button>
          </form>
        </mat-card>

        <!-- רשימת שיעורים -->
        <mat-list *ngIf="selectedCourseLessons.length > 0; else noLessons">
          <mat-list-item *ngFor="let lesson of selectedCourseLessons">
            <app-lesson-item
              [lesson]="lesson"
              [canEditOrDelete]="canEditOrDelete(course)"
              (deleted)="deleteLesson($event)"
              (edit)="editLesson($event)">
            </app-lesson-item>
          </mat-list-item>
        </mat-list>
        <ng-template #noLessons>
          <div style="margin-right: 30px; color: #bdbdbd;">אין שיעורים לקורס זה.</div>
        </ng-template>
      </mat-expansion-panel>
    </mat-accordion>
    <ng-template #noCourses>
      <div class="empty-state">
        <mat-icon style="font-size: 48px; color: #bdbdbd;">library_books</mat-icon>
        <div>אין קורסים קיימים כרגע.</div>
      </div>
    </ng-template>
  </mat-card-content>
</mat-card>
<!-- עריכת קורס -->
<mat-card *ngIf="editingCourse" #editCourseCard style="max-width: 400px; margin: 32px auto;">
  <mat-card-title style="text-align: right;">ערוך קורס</mat-card-title>
  <mat-card-content>
    <form [formGroup]="editCourseForm" (ngSubmit)="updateCourse()">
      <mat-form-field appearance="outline">
        <mat-label>כותרת</mat-label>
        <input matInput formControlName="title" required />
        <mat-error *ngIf="editCourseForm.controls['title'].hasError('required')">שדה זה חובה</mat-error>
      </mat-form-field>
      <mat-form-field appearance="outline">
        <mat-label>תיאור</mat-label>
        <textarea matInput formControlName="description" required></textarea>
        <mat-error *ngIf="editCourseForm.controls['description'].hasError('required')">שדה זה חובה</mat-error>
      </mat-form-field>
      <div class="actions">
        <button mat-raised-button color="primary" type="submit"
          [disabled]="editCourseForm.invalid || !editingCourse">שמור שינויים</button>
        <button mat-button type="button" (click)="cancelEdit()">בטל</button>
      </div>
    </form>
  </mat-card-content>
</mat-card>

<!-- עריכת שיעור -->
<mat-card *ngIf="editingLesson" style="max-width: 400px; margin: 32px auto;">
  <mat-card-title style="text-align: right;">ערוך שיעור</mat-card-title>
  <mat-card-content>
    <form [formGroup]="editLessonForm" (ngSubmit)="updateLesson()">
      <mat-form-field appearance="outline">
        <mat-label>כותרת</mat-label>
        <input matInput formControlName="title" required />
        <mat-error *ngIf="editLessonForm.controls['title'].hasError('required')">שדה זה חובה</mat-error>
      </mat-form-field>
      <div class="actions">
        <button mat-raised-button color="primary" type="submit"
          [disabled]="editLessonForm.invalid || !editingLesson">שמור שינויים</button>
        <button mat-button type="button" (click)="cancelEditLesson()">בטל</button>
      </div>
    </form>
  </mat-card-content>
</mat-card>